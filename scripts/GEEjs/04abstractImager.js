
//////////////////////////////////
//////////////////////////////////
//////////////////////////////////

// Landtrendr test module
var ltgee = require('users/clarype/emapr:Development/LandTrendr_V2.5D.js'); 

// Load in the Abstract image collection. This made from tiff_v7
var images = ee.ImageCollection("users/emaprlab/LTOP_Oregon_Abstract_Image");

// Import a ID layer
var id_points = ee.FeatureCollection('users/emaprlab/03_abstract_image_pixel_points');

// Rename the bands (can't upload with names as far as I can tell)
images = images.select(['b1','b2','b3','b4','b5'],['NBR', 'NDVI', 'TCG', 'TCW', 'B5']);

var indexname = "TCW"

// Add a time stamp to each image
images = images.map(add_time_stamp);

// Mask the "no-data" values
images = images.map(mask_no_data_values);

// Display the images
Map.addLayer(images,  {min:[0,-500,0], max:[1000,1000,1500]}, 'Abstract Collection');
Map.addLayer(id_points, {}, 'ID Points');
Map.centerObject(images, 16);

// Add a time stamp based on the system:id property
function add_time_stamp (image) {
  
  // Get the year from the system:id property
  var year = ee.Number.parse(ee.String(image.get('system:id')).slice(-4)).toInt16();
  
  // Create a date object
  var date = ee.Date.fromYMD(year, 8, 1).millis();
  
  return image.set('system:time_start', date);
  
}

// Update the mask to remove the no-data values so they don't mess
// up running LandTrendr -- assumes the no-data value is -32768
function mask_no_data_values (img) {
  
  // Create the mask
  var img_mask = img.neq(-32768);
  
  return img.updateMask(img_mask);
  
}

// LandTrendr Parameters 
///////////////////////////////////////////////////////////
var runParams = [{timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 6 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 6 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 8 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 8 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.75, vertexCountOvershoot: 3, prinObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery:]), maxSegments: 10 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 10 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 10 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.75, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.0nts: 11 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 0.9, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.25, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.5, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 0.9, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.05, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.1, bestModelProportion: 0.25, minObservationsNeeded: 11 }, {timeSeries: ee.ImageCollection([]), maxSegments: 11 , spikeThreshold: 1.0, vertexCountOvershoot: 3, preventOneYearRecovery: true, recoveryThreshold: 1.0, pvalThreshold: 0.15, bestModelProportion: 0.25, minObservationsNeeded: 11 }]
/////////////////////////////////////////////////////////


var getPoint2 = function(geom,img, z) {
  
  return img.reduceRegions({collection: geom, reducer: 'first',  scale: z })//.getInfo();

};

// getPoint2(id_points,lt_images,20); // add scale 30 some points (cluster_id 1800 for example) do not extract lt data. I compared the before change output with the after the chagne output and the data that was in both datasets matched. compared 1700 to 1700 ...  
  
  var attriIndexToData = getpin2.map(function(feature){return feature.set('index', indexname).set('params',runParams[index]);})

  return attriIndexToData

})

var featCol = ee.FeatureCollection([]);

for(var i in printer ){
  featCol = featCol.merge(printer[i])
}

Map.addLayer(featCol,{},'featCol')

Export.table.toDrive({
  collection: featCol,
  description: "LTOP_Oregon_abstractImageSample_5000pts_lt_144params_"+indexname+"_v2",
  folder: "LTOP_Oregon_abstractImageSamples_5000pts_v2",
  fileFormat: 'CSV'
});




